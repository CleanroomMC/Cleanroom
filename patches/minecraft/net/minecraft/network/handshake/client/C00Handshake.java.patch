--- before/net/minecraft/network/handshake/client/C00Handshake.java
+++ after/net/minecraft/network/handshake/client/C00Handshake.java
@@ -14,6 +14,7 @@
     private String ip;
     private int port;
     private EnumConnectionState requestedState;
+    private boolean hasFMLMarker = false;
 
     public C00Handshake()
     {
@@ -28,20 +29,26 @@
         this.requestedState = p_i47613_3_;
     }
 
-    @Override
+    public C00Handshake(String address, int port, EnumConnectionState state, boolean addFMLMarker)
+    {
+        this(address, port, state);
+        this.hasFMLMarker = addFMLMarker;
+    }
+
     public void readPacketData(PacketBuffer buf) throws IOException
     {
         this.protocolVersion = buf.readVarInt();
         this.ip = buf.readString(255);
         this.port = buf.readUnsignedShort();
         this.requestedState = EnumConnectionState.getById(buf.readVarInt());
+        this.hasFMLMarker = this.ip.contains("\0FML\0");
+        this.ip = this.ip.split("\0")[0];
     }
 
-    @Override
     public void writePacketData(PacketBuffer buf) throws IOException
     {
         buf.writeVarInt(this.protocolVersion);
-        buf.writeString(this.ip);
+        buf.writeString(this.ip + "\0FML\0");
         buf.writeShort(this.port);
         buf.writeVarInt(this.requestedState.getId());
     }
@@ -59,5 +66,10 @@
     public int getProtocolVersion()
     {
         return this.protocolVersion;
+    }
+
+    public boolean hasFMLMarker()
+    {
+        return this.hasFMLMarker;
     }
 }
